!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n=n||self).blobs2Animate={})}(this,function(n){"use strict";var M=function(){return(M=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var a in t=arguments[e])Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a]);return n}).apply(this,arguments)};function f(n){return{x:n.x,y:n.y,handleIn:M({},n.handleIn),handleOut:M({},n.handleOut)}}function h(e,r){for(var n=function(n){function t(n){return f(e[I(n,e.length)])}r({curr:f(e[n]),index:n,sibling:t,prev:function(){return t(n-1)},next:function(){return t(n+1)}})},t=0;t<e.length;t++)n(t)}function s(n,t){var e=[];return h(n,function(n){e.push(t(n))}),e}function o(n,t){return n.x===t.x&&n.y===t.y}function d(n,t){var e=t.x-n.x,r=-t.y+n.y,a=Math.atan2(r,e);return a<0?Math.abs(a):2*Math.PI-a}function g(n,t){return{x:n.x+t.length*Math.cos(t.angle),y:n.y+t.length*Math.sin(t.angle)}}function v(n,t){return{angle:d(n,t),length:Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}}function w(n,t,e){return t+n*(e-t)}function u(n){var t,e,r,a,i=function(n){for(var t=2166136261,e=0;e<n.length;e++)t=Math.imul(t^n.charCodeAt(e),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}}(n);return t=i(),e=i(),r=i(),a=i(),function(){var n=(t>>>=0)+(e>>>=0)|0;return t=e^e>>>9,e=(r>>>=0)+(r<<3)|0,r=(r=r<<21|r>>>11)+(n=n+(a=1+(a>>>=0)|0)|0)|0,(n>>>0)/4294967296}}function l(n,t){for(var e=2*Math.PI/n,r=[],a=0;a<n;a++){var i=t(),o=Math.sin(a*e),u=Math.cos(a*e);r.push({x:.5+o*i,y:.5+u*i,handleIn:{angle:0,length:0},handleOut:{angle:0,length:0}})}var l,h=4/3*Math.tan(e/4)/Math.sin(e/2)/2;return l=h,s(r,function(n){var t=n.curr,e=n.next,r=n.prev,a=d(r(),e());return{x:t.x,y:t.y,handleIn:{angle:a+Math.PI,length:l*O(t,r())},handleOut:{angle:a,length:l*O(t,e())}}})}function t(n){return 1-Math.pow(n-1,2)}function e(t){return function(n){return Math.pow(2,-10*n)*Math.sin((n-t/4)*(2*Math.PI)/t)+1}}function F(a,n){function t(n){for(var t=0;t<i;t++){for(var e=0,r=0;r<i&&(e+=Math.pow(100*O(a[r],n[I(r+t,i)]),2),!(o<e));r++);e<=o&&(o=e,u=t,l=n)}}var r,e,i=a.length,o=1/0,u=0,l=[];return t(n),t(s(r=n,function(n){var t=n.index,e=(0,n.sibling)(r.length-t-1);return e.handleIn.angle+=Math.PI,e.handleOut.angle+=Math.PI,e})),e=u,s(l,function(n){var t=n.index;return(0,n.sibling)(t+e)})}function P(n,t){if(t.length<3)throw new Error("not enough points");if(n<t.length)throw new Error("cannot remove points");if(n===t.length)return t.slice();var u=[];h(t,function(n){var t,e,r,a,i=n.curr,o=n.next;u.push((t=i,e=o(),r=g(t,t.handleOut),a=g(e,e.handleIn),(O(t,e)+O(r,a)+t.handleOut.length+e.handleIn.length)/2))});for(var e=A(u,n-t.length),r=[],a=0;a<t.length;a++){var i=r[r.length-1]||t[a],o=t[I(a+1,t.length)];r.pop(),r.push.apply(r,x(e[a],i,o))}var l=r.pop();return r[0].handleIn=l.handleIn,r}function S(n,i){return s(n,function(n){var t=n.index,e=n.curr,r=n.prev,a=n.next;return 0===e.handleIn.length&&o(r(),e)&&(e.handleIn.angle=i[t].handleIn.angle),0===e.handleOut.length&&o(a(),e)&&(e.handleOut.angle=i[t].handleOut.angle),e})}function C(n){return s(n,function(n){var t=n.curr,e=n.prev,r=n.next,a=d(e(),r());return 0===t.handleIn.length&&(t.handleIn.angle=a+Math.PI),0===t.handleOut.length&&(t.handleOut.angle=a),t})}function E(n,t,e){var r=2*Math.PI,a=I(t,r),i=I(e,r);return Math.abs(a-i)>Math.PI&&(a<i?a+=r:i+=r),w(n,a,i)}function c(){return String(Math.random()).substr(2)}function p(n){var t,e,r,a=n.renderCache,i=n.currentFrames;if(0===i.length)return{renderCache:a,lastFrameId:null,points:[]};if(1===i.length){var o=i[0];return{renderCache:a,lastFrameId:o.id,points:o.initialPoints}}for(var u=i[0],l=i[1],h=2;h<i.length&&!(l.timestamp>n.timestamp);h++)u=i[h-1],l=i[h];var s=l===i[i.length-1];if(l.timestamp<n.timestamp&&s)return{renderCache:a,lastFrameId:l.id,points:l.initialPoints};var d,c,f,g,v,p,m,y=null===(e=a[u.id])||void 0===e?void 0:e.preparedStartPoints,b=null===(r=a[l.id])||void 0===r?void 0:r.preparedEndPoints;y&&b||(d=u.initialPoints,c=l.initialPoints,g=(f={rawAngles:!1,divideRatio:1}).divideRatio*Math.max(d.length,c.length),v=P(g,d),p=P(g,c),m=F(v,p),y=(t=[f.rawAngles?v:S(C(v),m),f.rawAngles?m:S(C(m),v)])[0],b=t[1],a[u.id]=a[u.id]||{},a[u.id].preparedStartPoints=y,a[l.id]=a[l.id]||{},a[l.id].preparedEndPoints=b);var x=(n.timestamp-u.timestamp)/(l.timestamp-u.timestamp),I=Math.max(0,Math.min(1,x)),O=l.timingFunction(I);return{renderCache:a,lastFrameId:1===I?l.id:u.id,points:function(n,t,e){if(t.length!==e.length)throw new Error("must have equal number of points");for(var r=Math.min(1,Math.max(0,n)),a=[],i=0;i<t.length;i++)a.push(M(M({},j(n,t[i],e[i])),{handleIn:{angle:E(n,t[i].handleIn.angle,e[i].handleIn.angle),length:w(r,t[i].handleIn.length,e[i].handleIn.length)},handleOut:{angle:E(n,t[i].handleOut.angle,e[i].handleOut.angle),length:w(r,t[i].handleOut.length,e[i].handleOut.length)}}));return a}(O,y,b)}}function i(n,t,e){var r=typeof t;if("number"===r&&isNaN(t)&&(r="NaN"),"object"===r&&null===t&&(r="null"),!e.includes(r))throw'"'+n+'" should have type "'+e.join("|")+'" but was "'+r+'".'}var m,y,b,x=function(n,t,e){if(n<2)return[t,e];var r=function(n,t,e){var r=f(t);r.handleOut.length*=n;var a=f(e);a.handleIn.length*=1-n;var i=g(t,t.handleOut),o=g(e,e.handleIn),u=g(r,r.handleOut),l=g(a,a.handleIn),h=j(n,i,o),s=j(n,u,h),d=j(1-n,l,h),c=j(n,s,d);return[r,{x:c.x,y:c.y,handleIn:v(c,s),handleOut:v(c,d)},a]}(1/n,t,e),a=r[0],i=r[1],o=r[2];return 2===n?[a,i,o]:function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),a=0;for(t=0;t<e;t++)for(var i=arguments[t],o=0,u=i.length;o<u;o++,a++)r[a]=i[o];return r}([a],x(n-1,i,o))},I=function(n,t){return(n%t+t)%t},O=function(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))},j=function(n,t,e){return{x:w(n,t.x,e.x),y:w(n,t.y,e.y)}},z={linear:function(n){return n},easeEnd:t,easeStart:function(n){return 1-t(1-n)},ease:function(n){return.5+.5*Math.sin(Math.PI*(n+1.5))},elasticEnd0:e(1),elasticEnd1:e(.64),elasticEnd2:e(.32),elasticEnd3:e(.16)},A=function(n,t){for(var e=n.map(function(){return 1}),r=n.slice(),a=0;a<t;a++){for(var i=0,o=1;o<r.length;o++)(r[o]>r[i]||r[o]===r[i]&&n[o]>n[i])&&(i=o);e[i]++,r[i]=n[i]/e[i]}return e},r=(m=function(a){return s((n=a.blobOptions,t=u(String(n.seed)),e=1/(1+n.randomness/10),r=l(3+n.extraPoints,function(){return(e+t()*(1-e))/2}),i=n.size,s(r,function(n){var t=n.curr;return t.x*=i,t.y*=i,t.handleIn.length*=i,t.handleOut.length*=i,t})),function(n){var t,e,r=n.curr;return r.x+=(null===(t=null==a?void 0:a.canvasOptions)||void 0===t?void 0:t.offsetX)||0,r.y+=(null===(e=null==a?void 0:a.canvasOptions)||void 0===e?void 0:e.offsetY)||0,r});var n,t,e,r,i},y=function(n){var i=new Path2D;return n.length<1||(i.moveTo(n[0].x,n[0].y),h(n,function(n){var t=n.curr,e=(0,n.next)(),r=g(t,t.handleOut),a=g(e,e.handleIn);i.bezierCurveTo(r.x,r.y,a.x,a.y,e.x,e.y)})),i},b=function(n,t){try{!function(n){i("blobOptions",n,["object"]);var t=n.seed,e=n.extraPoints,r=n.randomness,a=n.size;if(i("blobOptions.seed",t,["string","number"]),i("blobOptions.extraPoints",e,["number"]),e<0)throw'blobOptions.extraPoints is invalid "'+e+'".';if(i("blobOptions.randomness",r,["number"]),r<0)throw'blobOptions.randomness is invalid "'+r+'".';if(i("blobOptions.size",a,["number"]),a<0)throw'blobOptions.size is invalid "'+a+'".'}(n.blobOptions),function(n){if(i("canvasOptions",n,["object","undefined"]),n){var t=n.offsetX,e=n.offsetY;i("canvasOptions.offsetX",t,["number","undefined"]),i("canvasOptions.offsetY",e,["number","undefined"])}}(n.canvasOptions),function(n){i("keyframe",n,["object"]);var t=n.delay,e=n.duration,r=n.timingFunction,a=n.callback;if(i("delay",t,["number","undefined"]),t&&t<0)throw'delay is invalid "'+t+'".';if(i("duration",e,["number"]),e&&e<0)throw'duration is invalid "'+e+'".';if(i("timingFunction",r,["string","undefined"]),r&&!z[r])throw'".timingFunction" is not recognized "'+r+'".';i("callback",a,["function","undefined"])}(n)}catch(n){throw"(blobs2): keyframe "+t+": "+n}},function(){function l(){return Date.now()-a}function t(){return 0!==r}function n(){t()&&(a+=l()-r,r=0)}function e(){t()||(r=l())}var h=[],s={},d={},r=0,a=0;return{renderFrame:function(){var n=p({renderCache:s,timestamp:t()?r:l(),currentFrames:h});return s=n.renderCache,n.lastFrameId&&d[n.lastFrameId]&&(d[n.lastFrameId](),delete d[n.lastFrameId]),y(n.points)},transition:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var e=0;e<n.length;e++)b(n[e],e);var r=function(n){var t=[];if(0===n.newFrames.length)return{newFrames:t};var e=p(n);if(null===e.lastFrameId){for(var r=n.shapeGenerator(n.newFrames[0]),a={x:0,y:0,handleIn:{angle:0,length:0},handleOut:{angle:0,length:0}},i=0,o=r;i<o.length;i++){var u=o[i];a.x+=u.x/r.length,a.y+=u.y/r.length}e.points=[a,a,a]}t.push({id:c(),initialPoints:e.points,timestamp:n.timestamp,timingFunction:z.linear,transitionSourceFrameIndex:-1,isSynthetic:!0});for(var l=0,h=0;h<n.newFrames.length;h++){var s=n.newFrames[h];if(s.delay){l+=s.delay;var d=t[t.length-1];t.push({id:c(),initialPoints:d.initialPoints,timestamp:n.timestamp+l,timingFunction:z.linear,transitionSourceFrameIndex:h-1,isSynthetic:!0})}l+=s.duration,t.push({id:c(),initialPoints:n.shapeGenerator(s),timestamp:n.timestamp+l,timingFunction:z[s.timingFunction||"linear"],transitionSourceFrameIndex:h,isSynthetic:!1})}return{newFrames:t}}({renderCache:s,timestamp:l(),currentFrames:h,newFrames:n,shapeGenerator:m});h=r.newFrames,d={},s={};for(var a=0,i=h;a<i.length;a++){var o=i[a];if(!o.isSynthetic){var u=n[o.transitionSourceFrameIndex].callback;u&&(d[o.id]=u)}}},play:n,pause:e,playPause:function(){(t()?n:e)()}}});n.canvasPath=r,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
